<!DOCTYPE HTML>  
<html>  
<head>
<title>H5STREAM VIDEO</title>
<script src="js/jquery-3.1.1.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/adapter.js"></script>
<script src="js/platform.js"></script>
<script src="js/h5splayer.js"></script>
<script src="js/h5splayerhelper.js"></script>


<meta http-equiv="content-type" content="text/html;charset=utf-8">

<link rel = "stylesheet" type = "text/css" href = "css/h5splayer.css" />

</head>

<body> 

<div >
	<div class="row">
    <video class="h5video" id="h5sVideoLocal" playsinline autoplay muted="muted" >
	</video>
	<video class="h5video" id="h5sVideoRemote"  playsinline autoplay>

    </video>
	</div>
	<div class="row">
	 <input type="input" size="38" id="user" placeholder="user1" value="user1" type="text"></button> <label >User</label> 
	</div>
	<div class="row">
	 <input type="input" size="38" id="remoteid" placeholder="Remote ID" value="5e247f0e-115b-466c-8683-346b449912b9" type="text"></button> <label >Remote ID</label> 
	</div>
	<button type="button" onclick="Connect()">Connect</button>
	<button type="button" onclick="CallVideoAudio()">CallVideoAudio</button>
	<button type="button" onclick="CallAudio()">CallAudio</button>
	<button type="button" onclick="AnswerVideoAudio()">AnswerVideoAudio</button>
	<button type="button" onclick="AnswerAudio()">AnswerAudio</button>
	<!-- <button type="button" onclick="Call()">CallRemoteDestop</button> -->
	<button type="button" onclick="Hangup()">Hangup</button>
	<button type="button" onclick="Disconnect()">Disconnect</button>
	<div class="select">
        <label for="videoSource">Video In: </label><select id="videoSource"></select>
    </div>
	
    <div class="select">
        <label for="audioSource">Audio In: </label><select id="audioSource"></select>
    </div>

    <div class="select">
        <label for="audioOutput">Audio Out: </label><select id="audioOutput"></select>
	</div>
    <div class="select">
        <label for="resolution">Resolution: </label><select id="resolution"></select>
	</div>
	
	<div class="row">
	 <textarea style="margin: 0px; width: 800px; height: 400px;" id="event1"  ></textarea> 
	</div>
</div>

</body>

<script>

/*
(event(string), userdata(object)) 
*/
var strSession = 'c1782caf-b670-42d8-ba90-2244d0b0ee83';
function EventCB(event, userdata)
{
	console.log("Event callback ", event);
	$('#event1').get(0).value = event + $('#event1').get(0).value;
	
	var msgevent = JSON.parse(event);
	if (msgevent.type === 'CFE_EVENT_PEER_CALL')
	{
		$('#remoteid').get(0).value = msgevent.peerCall.strId;
	}
	if (msgevent.type === 'CFE_EVENT_PEER_ADD')
	{
		$('#remoteid').get(0).value = msgevent.peerAdd.strId;
	}
	if (msgevent.type === 'CFE_EVENT_PEER_DEL')
	{
		console.log("User offline", msgevent.peerDel.strId);
	}
}

const videoSelect = document.querySelector('select#videoSource');
const audioInputSelect = document.querySelector('select#audioSource');
const audioOutputSelect = document.querySelector('select#audioOutput');
const resolutionSelect = document.querySelector('select#resolution');

function UpdateCapability(capability){
		console.log(capability);

		for (let i = 0; i !== capability['videoin'].length; ++i) {
			const data = capability['videoin'][i];
			const option = document.createElement('option');
			option.value = data.id;
			if (data.name === "")
			{
				data.name = data.id;
			}
			option.text = data.name;
			videoSelect.appendChild(option);
		}	

		for (let i = 0; i !== capability['audioin'].length; ++i) {
			const data = capability['audioin'][i];
			const option = document.createElement('option');
			option.value = data.id;
			if (data.name === "")
			{
				data.name = data.id;
			}
			option.text = data.name;
			audioInputSelect.appendChild(option);
			//alert(option.value);
		}
		
		for (let i = 0; i !== capability['audioout'].length; ++i) {
			const data = capability['audioout'][i];
			const option = document.createElement('option');
			option.value = data.id;
			if (data.name === "")
			{
				data.name = data.id;
			}
			option.text = data.name;
			audioOutputSelect.appendChild(option);
		}

		var resolution = ['QVGA', 'VGA', 'D1', '720P', '1080P', '4K', '8K']
		for (let i = 0; i !== resolution.length; ++i) {
			const data = resolution[i];
			const option = document.createElement('option');
			option.value = data;
			option.text = data;
			/* Default use 720P */
			if (option.value == '720P')
			{
				option.selected = true
			}
			resolutionSelect.appendChild(option);
		}
				
	}

H5sRTCGetCapability(UpdateCapability, 
					function(){
						console.log('RTC do not support !'); 
						});

var conf1 = {
	localvideoid:'h5sVideoLocal',
	remotevideoid:'h5sVideoRemote',
	//localvideodom: h5svideodomlocal,
	//remotevideodom: h5svideodomremove,
	localrecord: 'true', //{string} - true or false 
	remoterecord: 'true', //{string} - true or false 
	protocol: window.location.protocol, //http: or https:
	host: window.location.host, //localhost:8080
	rootpath:'/', // '/'
	user: $('#user').get(0).value,
	type:'media', // {string} - media or sharing
	callback: EventCB, 
	userdata: null, // user data
	session: strSession //session got from login
};

var v1;

$('#h5sVideoLocal').get(0).volume = 0;
$('#h5sVideoLocal').get(0).muted  = 0;

$('#h5sVideoRemote').get(0).volume = 0.4;

function Connect()
{
	console.log(conf1);
	v1 = new H5sConference(conf1);
	v1.connect();
	
}



function CallVideoAudio()
{
	console.log("CallVideoAudio");
	v1.call(true, $('#remoteid').get(0).value, videoSelect.value, resolutionSelect.value, audioInputSelect.value);
}

function CallAudio()
{
	console.log("CallAudio");
	v1.call(false, $('#remoteid').get(0).value, videoSelect.value, resolutionSelect.value, audioInputSelect.value);
}

function AnswerVideoAudio()
{
	console.log("AnswerVideoAudio");
	v1.answer(true, $('#remoteid').get(0).value, videoSelect.value, resolutionSelect.value, audioInputSelect.value);
}

function AnswerAudio()
{
	console.log("AnswerAudio");
	v1.answer(false, $('#remoteid').get(0).value, videoSelect.value, resolutionSelect.value, audioInputSelect.value);
}

function Hangup()
{
	console.log("Hangup");
	v1.hangup();
}

function Disconnect()
{
	console.log("Disconnect");
	v1.disconnect();
}







</script>

</html> 