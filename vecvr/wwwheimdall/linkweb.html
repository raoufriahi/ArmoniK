<!DOCTYPE HTML>  
<html>  
<head>
<title>LINKWEB VIDEO</title>
<script src="js/jquery-3.1.1.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/linkplayer.js"></script>

<link rel = "stylesheet" type = "text/css" href = "css/h5splayer.css" />

</head>

<body> 

<div class="h5videodiv1">
    <canvas class="h5video1" width=960 height=540 id="h5sVideo1" >

    </canvas>
    <div class="playpause" id="playpause1" ></div>
</div>

</body>

<script>
$(document).ready(function(){
	function GetURLParameter(sParam)
	{
		var sPageURL = window.location.search.substring(1);
		var sURLVariables = sPageURL.split('&');
		for (var i = 0; i < sURLVariables.length; i++) 
		{
			var sParameterName = sURLVariables[i].split('=');
			if (sParameterName[0] == sParam) 
			{
				return sParameterName[1];
			}
		}
	}

	var strToken;
	strToken = GetURLParameter("token");
	if (strToken === undefined)
	{
		strToken = 'token1';
	}
	
	var strStream;
	strStream = GetURLParameter("stream");
	if (strStream === undefined)
	{
		strStream = 'main';
	}
	
	console.log("token", strToken);
	console.log("stream", strStream);
	var bPlay = false;

	var conf1 = {
		videoid:'h5sVideo1',
		protocol: window.location.protocol, //'http:' or 'https:'
		host: window.location.host, //'localhost:8080'
		rootpath:'/', // '/'
		token:strToken,
		streamprofile: strStream, // {string} - stream profile, main/sub or other predefine transcoding profile
		session:'c1782caf-b670-42d8-ba90-2244d0b0ee83', //session got from login
		consolelog: 'true' // 'true' or 'false' enable/disable console.log
	};
	H5sPlayerCanvasGetLinkWebVersion(function(strVer){
										console.log(strVer); 
									}, 
									function(){
										console.log('Please install LinkWeb !'); 
									});
									
	var v1 = new H5sPlayerCanvas(conf1);
	if (GetURLParameter("autoplay") != undefined)
	{
		v1.connect();
		$('#playpause1').fadeOut();
	}

	$('#h5sVideo1').parent().click(function () {
		if(bPlay === false){
			if(v1 != null)
			{
				v1.disconnect();
				delete v1;
				v1 = null;
			}

			v1 = new H5sPlayerCanvas(conf1);
			
			console.log(v1);
			v1.connect();
			
			$(this).children(".playpause").fadeOut();
			bPlay = true;
		}else{
			v1.disconnect();
			delete v1;
			v1 = null;
			bPlay = false;
			$(this).children(".playpause").fadeIn();
		}
	});

	//IE don't close, need handle it 
	window.onbeforeunload = function() {
		if (v1)
		{
			v1.disconnect();
			v1 = null;
		}
	};

	console.log("SetupResizeEvent");
    function resize(videosize, cb) 
	{
		var resizeElement = document.createElement('iframe');
		console.log(resizeElement)
		resizeElement.style.width = '100%';
	    resizeElement.style.height = '100%';
		resizeElement.style.position= 'absolute';
		resizeElement.style.visibility='hidden';
		resizeElement.style.margin= '0';
		resizeElement.style.padding= '0';
		resizeElement.style.border= '0';
		videosize.appendChild(resizeElement);

		var oldWidth = videosize.offsetWidth;

		var oldHeight = videosize.offsetHeight;
		function sizeChange () 
		{
			var width = videosize.offsetWidth;

			var height = videosize.offsetHeight;
			if (width !== oldWidth || height !== oldHeight)
			{
				cb(width, height, oldWidth, oldHeight);
				oldWidth = width;
				oldHeight = height;
			}
		}

		var timer=0;
		resizeElement.contentWindow.onresize = function () 
		{
			clearTimeout(timer);
			timer = setTimeout(sizeChange, 1000);
		};
	 }

	 var videosize = document.querySelector('.h5videodiv1');;
	 console.log(videosize);
	 var h5sPlayer = this;
	 resize(videosize, function(width, height, oldWidth, oldHeight)  
	 {
		console.log("size change from: (", width, ":", height, ") to: (",  oldWidth, ":",  oldHeight, ")");
		//reconnect
		if (bPlay == true)
		{
			if(v1 != null)
			{
				v1.disconnect();
				delete v1;
				v1 = null;
			}
			

			v1 = new H5sPlayerCanvas(conf1);
			
			console.log(v1);
			v1.connect();
			
			$(this).children(".playpause").fadeOut();
			bPlay = true;
		}
	});

});



</script>

</html> 